# 20. Calling GraphQL from the Frontend (with `fetch` / `axios`)

### 1. Short Introduction

When you build a frontend app (React, Vue, etc.), you finally need to **call the GraphQL API** from the browser.

Good news:
Calling GraphQL is almost the same as calling a normal REST API.

The main difference:

* REST: you send different URLs ( `/students`, `/students/1` ).
* GraphQL: you always hit **one URL** (for example `/graphql`) and send a **query string** in the body.

We will see how to do this with:

* `fetch` (built into the browser)
* `axios` (popular HTTP library)

---

### 2. Why This Matters

As a backend developer, you may already:

* Call REST APIs from React / JS.
* Handle JSON responses.

To use GraphQL in real projects, you must know how to:

* Send a **query** or **mutation** from the frontend.
* Pass **variables**.
* Handle **loading**, **error**, and **data** states.

This is the “last mile” connection:
**Frontend → GraphQL server → Database / microservices.**

---

### 3. Use-Case Story – Student List Page

Imagine a **college web portal**.

* The portal has a page: “All Students”.
* The backend provides a GraphQL endpoint: `POST /graphql`.
* The frontend should show a table of students: `id`, `name`, `email`.

In a REST world you might call:

```http
GET /api/students
```

In GraphQL world, you call:

```http
POST /graphql
```

with a body like:

```json
{
  "query": "query { students { id name email } }"
}
```

The response is:

```json
{
  "data": {
    "students": [
      { "id": "1", "name": "Amit", "email": "amit@example.com" },
      { "id": "2", "name": "Sara", "email": "sara@example.com" }
    ]
  }
}
```

Your React component will:

1. Call `/graphql`.
2. Read `data.students`.
3. Show them on the screen.

---

### 4. Code Examples

#### 4.1 Sample GraphQL Schema (Backend Side – for context)

Just to remember what the backend might look like:

```graphql
type Student {
  id: ID!
  name: String!
  email: String!
}

type Query {
  students: [Student!]!
}
```

The frontend doesn’t need to know how this is implemented.
It only needs to know: “I can ask for `students { id name email }`.”

---

#### 4.2 Calling GraphQL with `fetch` in React

Here is a **simple React component** using `fetch`:

```jsx
// StudentListFetch.jsx
import React, { useEffect, useState } from "react";

const GRAPHQL_URL = "http://localhost:4000/graphql";

const STUDENT_LIST_QUERY = `
  query {
    students {
      id
      name
      email
    }
  }
`;

export default function StudentListFetch() {
  const [students, setStudents] = useState([]);
  const [loading, setLoading] = useState(true);
  const [errorMsg, setErrorMsg] = useState("");

  useEffect(() => {
    async function loadStudents() {
      try {
        setLoading(true);
        setErrorMsg("");

        const response = await fetch(GRAPHQL_URL, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            query: STUDENT_LIST_QUERY,
          }),
        });

        if (!response.ok) {
          throw new Error(`HTTP error: ${response.status}`);
        }

        const result = await response.json();

        if (result.errors) {
          // GraphQL-level errors
          throw new Error(result.errors[0].message);
        }

        setStudents(result.data.students);
      } catch (err) {
        setErrorMsg(err.message || "Something went wrong");
      } finally {
        setLoading(false);
      }
    }

    loadStudents();
  }, []);

  if (loading) {
    return <div>Loading students...</div>;
  }

  if (errorMsg) {
    return <div>Error: {errorMsg}</div>;
  }

  return (
    <div>
      <h2>Student List (fetch)</h2>
      <ul>
        {students.map((s) => (
          <li key={s.id}>
            {s.name} – {s.email}
          </li>
        ))}
      </ul>
    </div>
  );
}
```

Key points:

* `GRAPHQL_URL` is usually `/graphql`.
* We send `POST` with `"Content-Type": "application/json"`.
* Body has `{ query: STUDENT_LIST_QUERY }`.
* Response JSON has shape: `{ data: { students: [...] } }` (and maybe `errors`).

---

#### 4.3 Calling GraphQL with `axios` in React

Same thing, but with `axios`:

```bash
npm install axios
```

```jsx
// StudentListAxios.jsx
import React, { useEffect, useState } from "react";
import axios from "axios";

const GRAPHQL_URL = "http://localhost:4000/graphql";

const STUDENT_LIST_QUERY = `
  query {
    students {
      id
      name
      email
    }
  }
`;

export default function StudentListAxios() {
  const [students, setStudents] = useState([]);
  const [loading, setLoading] = useState(true);
  const [errorMsg, setErrorMsg] = useState("");

  useEffect(() => {
    async function loadStudents() {
      try {
        setLoading(true);
        setErrorMsg("");

        const response = await axios.post(GRAPHQL_URL, {
          query: STUDENT_LIST_QUERY,
        });

        const result = response.data;

        if (result.errors) {
          throw new Error(result.errors[0].message);
        }

        setStudents(result.data.students);
      } catch (err) {
        setErrorMsg(err.message || "Something went wrong");
      } finally {
        setLoading(false);
      }
    }

    loadStudents();
  }, []);

  if (loading) {
    return <div>Loading students...</div>;
  }

  if (errorMsg) {
    return <div>Error: {errorMsg}</div>;
  }

  return (
    <div>
      <h2>Student List (axios)</h2>
      <ul>
        {students.map((s) => (
          <li key={s.id}>
            {s.name} – {s.email}
          </li>
        ))}
      </ul>
    </div>
  );
}
```

---

#### 4.4 Using Variables in a GraphQL Request

Example: get a **single student by ID**.

GraphQL query with variable:

```graphql
query GetStudentById($id: ID!) {
  student(id: $id) {
    id
    name
    email
  }
}
```

Calling it with `fetch`:

```js
const query = `
  query GetStudentById($id: ID!) {
    student(id: $id) {
      id
      name
      email
    }
  }
`;

const variables = { id: "1" };

const response = await fetch(GRAPHQL_URL, {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({
    query,
    variables,
  }),
});
```

Key idea:

* For variables, send both `query` and `variables` in the JSON body.

---

#### 4.5 REST vs GraphQL Call – Side by Side

**REST example:**

```js
// get all students
const resp = await fetch("http://localhost:4000/api/students");
const data = await resp.json();
console.log(data); // maybe [{id, name, email}, ...]
```

**GraphQL example:**

```js
const graphqlQuery = `
  query {
    students {
      id
      name
      email
    }
  }
`;

const resp = await fetch("http://localhost:4000/graphql", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({ query: graphqlQuery }),
});

const result = await resp.json();
console.log(result.data.students);
```

Difference:

* REST: URL tells what you want.
* GraphQL: **query string** tells what you want.

---

### 5. Diagram – Frontend Calling GraphQL

Simple data flow:

```text
React Component
    |
    |  POST /graphql  (query string in JSON body)
    v
GraphQL Server
    |
    |  Uses resolvers to fetch data
    v
Database / Other Services
```

Front to back:

1. User opens “Student List” page.
2. React calls `/graphql` with a query.
3. GraphQL server runs resolvers.
4. Resolvers fetch data from DB or microservices.
5. GraphQL server returns JSON `{ data: { ... } }`.
6. React shows students on screen.

---

### 6. How to Instruct Codex to Automate This

You can use Codex as your **coding assistant**.

Here are some ready-to-use prompts:

1. **Basic React + fetch:**

   > “Generate a simple React component that calls a GraphQL endpoint using fetch and displays a list of students.”

2. **React + axios version:**

   > “Generate a React component that uses axios to call a GraphQL endpoint /graphql and renders a table of students with id, name, and email.”

3. **Add loading and error states:**

   > “Improve this React component that calls a GraphQL API by adding loading and error states and showing friendly messages on the screen.”

4. **Use variables in query:**

   > “Create a React component with an input box for student id, a button ‘Load Student’, and code that calls a GraphQL query with variables to fetch that single student.”

5. **Refactor into reusable function:**

   > “Refactor this React code that calls GraphQL so that the GraphQL fetch logic is in a separate helper function called callGraphQL(query, variables).”

---

### 7. Summary

1. Calling GraphQL from the frontend is just sending a **POST** request to `/graphql` with `{ query, variables }` in JSON.
2. You can use `fetch` or `axios` to call GraphQL, then read `result.data` and handle `result.errors`.
3. The main difference from REST is: **one URL, flexible query string** that controls exactly what fields you receive.
