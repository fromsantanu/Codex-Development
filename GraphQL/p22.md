# 22. Showing Tables, Charts, and Forms with GraphQL Data

---

### 1. Short Introduction

Once your frontend can **call** a GraphQL API, the next step is to **show the data nicely**:

* As **tables** (lists of items)
* As **charts** (trends, summaries)
* As **forms** (send data back with mutations)

Think of GraphQL as the **kitchen** that gives you clean, well-cut ingredients (data).
Your UI (React / NiceGUI) is the **serving plate** where you arrange them nicely.

---

### 2. Why This Matters

In real business apps (clinic, shop, school, etc.) you almost always need:

* A **table** view (list of students, patients, orders)
* A **chart** view (sales per month, patients per disease)
* A **form** view (add / edit records)

GraphQL makes it easy to get **exactly the right data** for these screens.
If you can show tables, charts, and forms from GraphQL, you can build most dashboards.

---

### 3. Use-Case Story – “Student Analytics” Page

Imagine a **college admin** page:

1. A **table** of students: `id, name, email`.
2. A **chart** showing number of students per course.
3. A **form** to add a new student.

Backend gives you:

* Query: `students` → list of students (for the table)
* Query: `studentsPerCourse` → summary data (for the chart)
* Mutation: `addStudent` → add new student (from the form)

Your UI will:

1. Call GraphQL queries.
2. Show tables and charts.
3. Use a form to call a mutation.

---

### 4. Code Examples

#### 4.1 Example GraphQL Schema (backend)

```graphql
type Student {
  id: ID!
  name: String!
  email: String!
  course: String!
}

type StudentsPerCourse {
  course: String!
  count: Int!
}

type Query {
  students: [Student!]!
  studentsPerCourse: [StudentsPerCourse!]!
}

input AddStudentInput {
  name: String!
  email: String!
  course: String!
}

type Mutation {
  addStudent(input: AddStudentInput!): Student!
}
```

---

#### 4.2 React: Table + Simple Error Handling (GraphQL Query)

```jsx
// StudentTable.jsx
import React, { useEffect, useState } from "react";

const GRAPHQL_URL = "http://localhost:4000/graphql";

const STUDENTS_QUERY = `
  query {
    students {
      id
      name
      email
      course
    }
  }
`;

export default function StudentTable() {
  const [students, setStudents] = useState([]);
  const [loading, setLoading] = useState(true);
  const [errorMsg, setErrorMsg] = useState("");

  useEffect(() => {
    async function loadStudents() {
      try {
        setLoading(true);
        setErrorMsg("");

        const res = await fetch(GRAPHQL_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ query: STUDENTS_QUERY }),
        });

        if (!res.ok) {
          throw new Error(`HTTP error ${res.status}`);
        }

        const result = await res.json();
        if (result.errors) {
          throw new Error(result.errors[0].message);
        }

        setStudents(result.data.students);
      } catch (err) {
        setErrorMsg(err.message || "Something went wrong");
      } finally {
        setLoading(false);
      }
    }

    loadStudents();
  }, []);

  if (loading) return <div>Loading students…</div>;
  if (errorMsg) return <div style={{ color: "red" }}>Error: {errorMsg}</div>;

  return (
    <div>
      <h2>Students</h2>
      <table border="1" cellPadding="4">
        <thead>
          <tr>
            <th>ID</th><th>Name</th><th>Email</th><th>Course</th>
          </tr>
        </thead>
        <tbody>
          {students.map(s => (
            <tr key={s.id}>
              <td>{s.id}</td>
              <td>{s.name}</td>
              <td>{s.email}</td>
              <td>{s.course}</td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  );
}
```

This shows **how to turn GraphQL data into a table** with basic error handling.

---

#### 4.3 React: Simple Chart from GraphQL Data

Here we assume you get data like:

```json
{
  "data": {
    "studentsPerCourse": [
      { "course": "Math", "count": 10 },
      { "course": "Physics", "count": 8 }
    ]
  }
}
```

Simple example using a basic list “chart” (no chart library yet):

```jsx
// StudentsPerCourseChart.jsx
import React, { useEffect, useState } from "react";

const GRAPHQL_URL = "http://localhost:4000/graphql";

const STUDENTS_PER_COURSE_QUERY = `
  query {
    studentsPerCourse {
      course
      count
    }
  }
`;

export default function StudentsPerCourseChart() {
  const [rows, setRows] = useState([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    async function load() {
      const res = await fetch(GRAPHQL_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ query: STUDENTS_PER_COURSE_QUERY }),
      });
      const result = await res.json();
      setRows(result.data.studentsPerCourse);
      setLoading(false);
    }
    load();
  }, []);

  if (loading) return <div>Loading chart…</div>;

  return (
    <div>
      <h2>Students per Course (simple bar)</h2>
      <ul>
        {rows.map(r => (
          <li key={r.course}>
            {r.course}: {"▮".repeat(r.count)} ({r.count})
          </li>
        ))}
      </ul>
    </div>
  );
}
```

This is a **text-based chart** (just to show the idea):
In real apps, you replace it with a chart library like Chart.js / Recharts.

---

#### 4.4 React: Simple Form Calling a GraphQL Mutation

```jsx
// AddStudentForm.jsx
import React, { useState } from "react";

const GRAPHQL_URL = "http://localhost:4000/graphql";

const ADD_STUDENT_MUTATION = `
  mutation AddStudent($input: AddStudentInput!) {
    addStudent(input: $input) {
      id
      name
      email
      course
    }
  }
`;

export default function AddStudentForm({ onStudentAdded }) {
  const [name, setName] = useState("");
  const [email, setEmail] = useState("");
  const [course, setCourse] = useState("");
  const [errorMsg, setErrorMsg] = useState("");
  const [saving, setSaving] = useState(false);

  async function handleSubmit(e) {
    e.preventDefault();

    try {
      setSaving(true);
      setErrorMsg("");

      const res = await fetch(GRAPHQL_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          query: ADD_STUDENT_MUTATION,
          variables: {
            input: { name, email, course },
          },
        }),
      });

      const result = await res.json();
      if (result.errors) {
        throw new Error(result.errors[0].message);
      }

      const newStudent = result.data.addStudent;
      onStudentAdded && onStudentAdded(newStudent);

      setName("");
      setEmail("");
      setCourse("");
    } catch (err) {
      setErrorMsg(err.message || "Could not save");
    } finally {
      setSaving(false);
    }
  }

  return (
    <form onSubmit={handleSubmit}>
      <h3>Add Student</h3>
      {errorMsg && <div style={{ color: "red" }}>{errorMsg}</div>}
      <div>
        Name:{" "}
        <input value={name} onChange={e => setName(e.target.value)} required />
      </div>
      <div>
        Email:{" "}
        <input
          value={email}
          onChange={e => setEmail(e.target.value)}
          required
        />
      </div>
      <div>
        Course:{" "}
        <input
          value={course}
          onChange={e => setCourse(e.target.value)}
          required
        />
      </div>
      <button type="submit" disabled={saving}>
        {saving ? "Saving…" : "Save"}
      </button>
    </form>
  );
}
```

Now you can combine everything in a **page**:

* `StudentTable` to show data
* `StudentsPerCourseChart` for trend
* `AddStudentForm` to add new data

All powered by GraphQL.

---

#### 4.5 NiceGUI: Table from GraphQL Data (simple example)

```python
# app.py
from nicegui import ui
import httpx

GRAPHQL_URL = 'http://localhost:4000/graphql'

STUDENTS_QUERY = """
query {
  students {
    id
    name
    email
    course
  }
}
"""

async def load_students():
  async with httpx.AsyncClient() as client:
    response = await client.post(
      GRAPHQL_URL,
      json={'query': STUDENTS_QUERY},
      timeout=10.0,
    )
    data = response.json()
    if 'errors' in data:
      raise Exception(data['errors'][0]['message'])
    return data['data']['students']

@ui.page('/')
async def main():
  ui.label('Students (GraphQL + NiceGUI)')

  status = ui.label('Loading...')
  table = ui.table(
    columns=[
      {'name': 'id', 'label': 'ID', 'field': 'id'},
      {'name': 'name', 'label': 'Name', 'field': 'name'},
      {'name': 'email', 'label': 'Email', 'field': 'email'},
      {'name': 'course', 'label': 'Course', 'field': 'course'},
    ],
    rows=[],
  )

  try:
    students = await load_students()
    table.rows = students
    status.text = f'Loaded {len(students)} students'
  except Exception as e:
    status.text = f'Error: {e}'

ui.run()
```

This shows how to:

* Call GraphQL from a Python frontend (NiceGUI)
* Show the data in a table
* Show basic loading / error messages

---

### 5. Simple Diagram

```text
GraphQL Server
   |    \
   |     \   studentsPerCourse
   |      \
students    \
   |          \
   v           v
Table UI    Chart UI
   \          /
    \        /
        Form UI (mutation: addStudent)
            |
          GraphQL
```

Data flow:

1. Table calls `students` query.
2. Chart calls `studentsPerCourse` query.
3. Form calls `addStudent` mutation.
4. All three use the **same GraphQL endpoint**, but different queries/mutations.

---

### 6. How to Instruct Codex to Automate This

You can ask Codex to generate full pages using these prompts:

1. **Table with error handling (React):**

   > “Generate a React page that calls a GraphQL endpoint to fetch a list of students and shows them in an HTML table with basic loading and error handling.”

2. **NiceGUI table from GraphQL:**

   > “Generate a NiceGUI page in Python that calls a GraphQL query /graphql to get students { id, name, email } and displays the data in a table with simple error messages.”

3. **Page with table + form (React):**

   > “Generate a React component that calls a GraphQL students query to show a table, and also includes a form that calls an addStudent mutation. After a successful mutation, refresh the table.”

4. **Add a chart on top of GraphQL data:**

   > “Using this GraphQL query studentsPerCourse { course count }, generate a React component that builds a simple bar chart using a chart library and shows the data with loading and error states.”

5. **Refactor for reusability:**

   > “Refactor this page so that the GraphQL fetch logic is moved into a separate helper function or custom hook, and the React component only handles layout (table, chart, form).”

---

### 7. Summary

1. GraphQL data can be used to easily power **tables, charts, and forms** in your UI.
2. Tables and charts are just different ways of showing the same JSON data you get from GraphQL queries.
3. Forms send data back to the server through **mutations**, and Codex can help you quickly build and refactor these UIs for React or NiceGUI.

