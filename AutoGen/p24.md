### Chapter 24. Deployment on Cloud

**VPS, Docker, and environment variables for your Autogen app**

---

#### 1. Why deploy on the cloud?

So far, you’ve probably run your Autogen apps:

* On your **own laptop**
* In a local **virtual environment**
* With a simple `python main.py`

That’s fine for testing.
But if you want:

* Students to try your demo
* A clinic / shop / team to use it
* To show it in an interview

…you need it running on the **internet**, not just your laptop.

That is where:

* **VPS** (Virtual Private Server)
* **Docker**
* **Environment variables**

come in.

Think of it as:

> You built a machine (Autogen app).
> Now you rent a small shop (VPS), put the machine inside a box (Docker),
> and keep the keys in a safe place (environment variables).

---

#### 2. What is a VPS in simple words?

A **VPS (Virtual Private Server)** is like renting a **small room in a big building**:

* The building = large cloud server (e.g., DigitalOcean, Linode, AWS, etc.)
* Your room (VPS) = a small slice of that server only you can use

In that room, you can:

* Install Python, Docker, etc.
* Run your Autogen app 24x7
* Make it accessible via a public URL (through Nginx, etc., later)

For now, just remember: **VPS = always-on remote computer**.

---

#### 3. What is Docker? (Very simple view)

Imagine you want to move your Autogen app:

* From your laptop
* To your VPS
* And maybe later to another server

If you manually install Python, dependencies, libraries every time, it’s painful.

**Docker** solves this:

* Docker is like a **shipping container** for your app.
* You pack:

  * Code
  * Dependencies
  * Python version
* into one container.

Wherever you send that container (VPS A, VPS B, your laptop),
it behaves the **same way**.

So for Autogen apps:

* You write a **Dockerfile** that describes how to build this container.
* Then you run it in any server that has Docker installed.

---

#### 4. What are environment variables?

You have some **secret or changeable values**:

* `OPENAI_API_KEY`
* Database URL
* Debug mode (`True/False`)

These should **not** be hard-coded into your Python files.

Instead, we store them as **environment variables**, like:

* `OPENAI_API_KEY=sk-xxxxxxx`
* `APP_ENV=production`

Think of this as:

> You keep your important keys in a **locker**.
> Your code knows which locker to open, but the keys are not written on the code pages.

Tools like **Docker** and **docker-compose** make it easy to pass these variables to your app.

---

#### 5. Example project structure

Let’s assume your Autogen app looks like this:

```
autogen_app/
├─ main.py           # your Autogen app entry point
├─ requirements.txt  # Python dependencies
├─ .env              # environment variables (not committed to Git)
├─ Dockerfile
└─ docker-compose.yml
```

* `main.py` will read environment variables (like `OPENAI_API_KEY`) using `os.getenv()`.

Example `main.py` (very simplified):

```python
import os

def run_app():
    api_key = os.getenv("OPENAI_API_KEY", "missing")
    print("Starting Autogen app...")
    print("Using API key:", "set" if api_key != "missing" else "NOT SET")

if __name__ == "__main__":
    run_app()
```

And `requirements.txt` might contain:

```text
openai
pyautogen
fastapi
uvicorn
```

(Use whatever your real project needs.)

---

#### 6. Dockerfile for the Autogen app

Here is a simple **Dockerfile**:

```dockerfile
# Use an official Python image as base
FROM python:3.11-slim

# Set working directory inside the container
WORKDIR /app

# Copy requirements first (better caching)
COPY requirements.txt .

# Install dependencies
RUN pip install --no-cache-dir -r requirements.txt

# Copy the rest of the app code
COPY . .

# Expose a port if your app runs a web server (e.g., FastAPI on 8000)
EXPOSE 8000

# Default command
# Adjust this based on how you start your app
# Example: run a FastAPI app using uvicorn
CMD ["python", "main.py"]
```

What this does:

* Starts from a minimal Python image
* Installs dependencies
* Copies your code
* Runs `main.py` when the container starts

If your app uses FastAPI with Uvicorn, your `CMD` might be something like:

```dockerfile
CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"]
```

---

#### 7. docker-compose.yml for the Autogen app

Now let’s add **docker-compose**, which helps run everything with **one command** and handle environment variables nicely.

```yaml
version: "3.9"

services:
  autogen_app:
    build: .
    container_name: autogen_app_container
    env_file:
      - .env
    ports:
      - "8000:8000"
    restart: unless-stopped
```

Explanation in simple terms:

* `build: .` → Build the Docker image using the `Dockerfile` in the current folder.
* `env_file: - .env` → Load environment variables from `.env` file.
* `ports: "8000:8000"` → Expose the app on port 8000 of your VPS.
* `restart: unless-stopped` → If the container crashes, restart it automatically.

---

#### 8. The `.env` file (not committed to Git)

Create a `.env` file in the same folder:

```env
OPENAI_API_KEY=sk-your-real-key-here
APP_ENV=production
```

**Important:**

* Never push real keys to GitHub.
* `.env` should be in `.gitignore`.

---

#### 9. Running locally (before cloud)

First, test everything on your own machine.

In the project folder:

```bash
docker-compose build
docker-compose up
```

You should see logs from your Autogen app.
If it’s a web app, open: `http://127.0.0.1:8000`

If it prints to console (like our simple `run_app()`), you’ll see the output in the terminal.

---

#### 10. Moving to a VPS (high-level idea)

Once it works locally:

1. **Create a VPS** (e.g., Ubuntu 22.04) on any cloud provider.
2. **SSH into the VPS** (like remote login).
3. Install:

   ```bash
   sudo apt update
   sudo apt install -y docker.io docker-compose
   ```
4. Copy your project (via `git clone` or `scp`).
5. Put your **real** `.env` file there (with real keys).
6. Run:

   ```bash
   docker-compose build
   docker-compose up -d
   ```

Now your Autogen app is running on the VPS.
Later, you can add **Nginx + domain + SSL**, but this basic step already gives you a working cloud deployment.

---

#### 11. Takeaway

* **VPS** = remote always-on computer.
* **Docker** = packing your Autogen app into a portable container.
* **Environment variables** = safe, flexible way to store keys and settings.
* `Dockerfile` + `docker-compose.yml` give you a repeatable way to run your app locally and on cloud.

Once you understand this, you can deploy almost any Autogen-based system in a clean, professional way.

---

#### 12. Codex Instruction Prompt for this Chapter

You can give this to Codex:

> “For a simple Autogen-based Python app with main.py and requirements.txt, write a Dockerfile and a docker-compose.yml file. The app should read OPENAI_API_KEY from environment variables using a .env file, expose port 8000, and be easy to run on a VPS. Add clear comments explaining each part for beginners.”
