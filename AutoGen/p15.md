# Chapter 15. Adding Custom Tools

*Example: Unit converter, calculator, hospital triage tool*

---

#### 1. What is a “custom tool” for an agent?

So far you have seen tools like:

* Weather tool → calls weather API
* File tool → saves summaries to `.txt`
* Database tool → stores restaurant bookings
* Search tool → calls Google/Bing

A **custom tool** simply means:

> “Any Python function you write,
> which the agent is allowed to call.”

You decide **what** it does:

* A simple **calculator**
* A **unit converter** (kg ↔ pounds, cm ↔ inches)
* A **hospital triage helper** (decides urgency based on symptoms)
* A **discount calculator** for a shop
* A **score calculator** for students

Once you give this function to the agent as a **tool**, the agent can:

* Understand your natural language request
* Decide to call the tool
* Use the result in its reply

---

#### 2. Simple analogy: agent + toolbox

Imagine:

* The agent is a **smart doctor**.
* The tools are **instruments** in the doctor’s bag:

  * thermometer
  * blood pressure machine
  * stethoscope

The doctor:

* Listens to the patient (like the agent reads the user message)
* Chooses which instrument to use
* Then explains what they found

In Autogen:

* The agent listens to the user
* Chooses which **Python tool function** to call
* Then speaks using both its reasoning and the tool’s result

---

#### 3. Examples of custom tools (conceptual)

You can build many:

1. **Calculator tool**

   * Input: `"2 * (3 + 5)"`
   * Output: `"16"`

2. **Unit converter tool**

   * Input: `value=70, from_unit="kg", to_unit="lb"`
   * Output: `"70 kg is about 154.32 lb"`

3. **Hospital triage tool** (very simplified)

   * Input: age, temperature, chest_pain, breathing_issue
   * Output: `"High priority"`, `"Medium priority"`, `"Low priority"`

In this chapter, we’ll focus on a **calculator tool** and show how to:

1. Write the Python function
2. Wrap it as a tool
3. Register it with an Autogen agent
4. Let the agent use it in a conversation

---

#### 4. Step-by-step: calculator tool

We want a function:

```text
calculate("2 + 3 * 4") → "The result is 14"
```

For teaching, we’ll use Python’s `eval` carefully, and clearly mark that in a real system you might want a safer math parser (for security).

##### 4.1. The Python function

```python
import math

def calculator(expression: str) -> str:
    """
    Evaluate a basic math expression given as a string.
    Example: '2 + 3 * (4 - 1)'.
    
    WARNING: In real systems, avoid using eval directly.
    Use a safe math parser library instead.
    """
    try:
        # Limit the available built-ins for some safety
        allowed_names = {
            "math": math,
            "__builtins__": {}
        }

        result = eval(expression, allowed_names, {})
        return f"The result of {expression} is {result}"
    except Exception as e:
        return f"Could not evaluate expression '{expression}': {e}"
```

What this does:

* Takes text like `"2 + 3 * (4 - 1)"`
* Tries to compute it
* Returns a friendly string with the result
* If something goes wrong, it returns an error message

---

#### 5. Wrapping the calculator as an Autogen tool

Now we tell Autogen:
“This function is a tool the agent can use.”

```python
from autogen import AssistantAgent, UserProxyAgent

# 1. Wrap the function in a tool description
calculator_tool = {
    "name": "calculator",
    "description": (
        "Evaluate basic math expressions given as a string. "
        "Use this whenever the user asks for calculations."
    ),
    "func": calculator,
}

# 2. Create an agent that can use this tool
math_agent = AssistantAgent(
    name="math_agent",
    system_message=(
        "You are a helpful math assistant. "
        "When the user asks you to compute or calculate something, "
        "use the calculator tool instead of doing mental math."
    ),
    tools=[calculator_tool],
)

# 3. User proxy to chat with the agent
user = UserProxyAgent(name="user")

# 4. Example conversation
message = (
    "I sold 120 items at 250 rupees each and my cost was 18,000. "
    "Please calculate my total revenue and profit using a calculation."
)

reply = user.initiate_chat(math_agent, message=message)
print("Agent reply:\n", reply)
```

What happens step by step:

1. The user asks a question that clearly needs **math**.
2. `math_agent` reads the message.
3. It decides: “I should use my **calculator tool**.”
4. It creates an expression like: `"120 * 250 - 18000"` (or similar).
5. It calls `calculator(expression)`.
6. The calculator returns the result as text.
7. The agent explains the answer in simple language to the user.

---

#### 6. Extending the idea: other custom tools

Once you understand this pattern, you can add many tools:

* **Unit converter tool**

  ```python
  def convert_kg_to_lb(kg: float) -> str:
      lb = kg * 2.20462
      return f"{kg} kg is about {lb:.2f} lb"
  ```

* **Hospital triage tool** (very simple example, not medical advice!)

  ```python
  def triage(age: int, temperature: float, chest_pain: bool, breathing_issue: bool) -> str:
      # Very rough rules just for a demo
      if chest_pain or breathing_issue:
          return "High priority: immediate doctor check advised."
      if temperature > 38.5:
          return "Medium priority: see doctor soon."
      return "Low priority: monitor at home, if symptoms worsen see doctor."
  ```

Each of these can be wrapped as tools and added to an agent **exactly the same way** as the calculator:

* create the Python function
* define a `{ "name", "description", "func" }` dict
* pass it in the `tools=[...]` list when creating the agent

---

#### 7. Takeaway

* A **custom tool** is just a Python function you give to the agent.
* The agent uses these tools to **act**, not just **chat**.
* You saw how to:

  * write a calculator function
  * wrap it as an Autogen tool
  * register it with an agent
  * let the agent use it during a normal conversation

This is how you turn a simple chatbot into a **practical assistant** for:

* math and finance
* unit conversion
* clinic triage
* any rule-based calculation or processing

---

#### Codex Instruction for this Chapter

> **“Create a Python calculator tool function that evaluates basic math expressions from a string. Then register this tool with an Autogen AssistantAgent and show a short example where the user asks for a calculation and the agent uses the tool to answer.”**
