# Chapter 11. Calling APIs from Agents

*Example: Weather-checking agent*

---

#### 1. Why agents need APIs

So far, our agents mostly *talk* and *think*.
Now we want them to *do things in the real world*.

For that, they need **APIs**.

* An **API** is like a **window** in a wall.
* Your agent is inside the room (the program).
* The outside world (weather service, stock prices, maps, clinic data, etc.) is outside.
* The API window lets the agent **ask questions** and **get answers**, in a fixed format.

Example in daily life:

* You call a **restaurant** and say: “What’s today’s menu?”
* The staff doesn’t tell stories. They read from a **fixed list**: “Paneer, dal, rice…”.
* That’s like an API: you ask in a fixed way, you get a structured answer.

For our agents:

* The agent will say: “Hey, weather service, what is the temperature in Delhi?”
* The weather API replies: “temperature: 32°C, condition: Sunny”.

Our job is to **connect** the agent to that API.

---

#### 2. Basic idea: Agent → Python function → Weather API

We usually don’t let the agent talk to the internet directly.

Instead, the usual pattern is:

1. **Agent**: “I need the weather for Kolkata.”
2. **Python function**: receives the city, calls the weather API.
3. **API response**: comes back as JSON (a structured text format).
4. **Python function**: cleans it into a nice short message.
5. **Agent**: uses that answer to reply to the user.

You can think of the Python function as a **trusted assistant** who goes outside, checks the board, and comes back with the answer.

---

#### 3. Small weather agent example (conceptual)

Here is a **simple picture** of what we want:

* User: “What’s the weather in London?”
* Agent: “I will call my weather tool.”
* Weather tool: “Call the weather API and return temperature + description.”
* Agent: “In London it is 18°C and cloudy.”

In code, this usually means:

1. Define a **Python function** `get_weather(city)`.
2. Inside it, call a **weather API** (could be a free demo API).
3. Register this function as a **tool** that the agent is allowed to use.
4. Ask the agent a question and let it decide when to call the tool.

---

#### 4. Simple Python sketch (Autogen + weather API)

Don’t worry if the code looks a bit heavy.
Just understand the **flow**: agent → tool → API → back.

```python
import requests
from autogen import AssistantAgent, UserProxyAgent

# 1. This function talks to the weather API
def get_weather(city: str) -> str:
    """
    Simple helper that calls a (fake) weather API
    and returns a human-friendly sentence.
    """
    # Example URL (you will replace with a real API)
    url = f"https://api.example.com/weather?city={city}"

    response = requests.get(url)
    data = response.json()

    temperature = data["temperature"]
    condition = data["condition"]

    return f"In {city}, it is {temperature}°C and {condition}."

# 2. Wrap the function as a tool description
weather_tool = {
    "name": "get_weather",
    "description": "Get current weather for a given city name.",
    "func": get_weather,
}

# 3. Create an assistant agent that can use this tool
weather_agent = AssistantAgent(
    name="weather_agent",
    system_message=(
        "You are a helpful weather assistant. "
        "Use the get_weather tool when the user asks about weather."
    ),
    tools=[weather_tool],
)

# 4. A user proxy to start the conversation
user = UserProxyAgent(name="user")

# 5. Ask a question; the agent will decide to call the weather API
user_message = "What is the weather like in Kolkata today?"
reply = user.initiate_chat(weather_agent, message=user_message)

print("Agent reply:", reply)
```

What’s happening here in simple words:

* `get_weather(city)` is like a **phone call** to the weather office.
* `weather_tool` tells the agent:

  * the tool’s **name**,
  * what it **does**,
  * and **which Python function** to run.
* `weather_agent` is an Autogen agent that:

  * reads the user’s question,
  * decides: “I should use `get_weather` for this,”
  * runs the tool,
  * and then answers with the result.
* `user.initiate_chat(...)` just **starts the conversation**.

---

#### 5. Real-world usefulness

Once you learn to do this for weather, you can do the same for:

* **Currency conversion agent**
  – Calls an exchange rate API.

* **News agent**
  – Calls a news API and summarises headlines.

* **Clinic helper agent**
  – Calls your backend API to fetch patient data or lab results.

The pattern is always:

> Agent → Python tool → External API → back to Agent → User.

---

#### 6. Takeaway

* APIs let your agents **talk to the outside world**.
* Use a **Python function** as a safe layer between agent and API.
* Register that function as a **tool** for the agent.
* Now your agent can not only chat, but also **act** and **fetch live data**.

---

#### Codex Instruction for this Chapter

> **“Generate code where an Autogen agent calls a real weather API (like OpenWeatherMap).
> Include: a get_weather(city) function using requests, tool registration, and a short demo where the user asks for the weather in one city.”**
