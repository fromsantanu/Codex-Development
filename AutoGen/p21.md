# Chapter 21. Building APIs for Agents

**Creating FastAPI endpoints so agents can use tools**

---

#### 1. Why do agents need APIs?

Think of your agent as a very smart employee sitting in an office.

* The **agent** can think and talk.
* But to **do things** (save data, run a model, call a service), it needs **doors** to other systems.
* These doors are called **APIs**.

In this chapter, we will:

* Build a simple **FastAPI** server.
* Expose one endpoint: **`/predict`**.
* This endpoint will act like a **tool** that your Autogen agent can call.

You can imagine it as:

> Agent = receptionist
> FastAPI `/predict` = “Ask the senior analyst for a prediction.”

---

#### 2. What is an endpoint, in simple words?

Real-life comparison:
In a hospital, you have different **counters**:

* Registration counter
* Billing counter
* Lab test counter

Each counter has a **specific job** and a **window** where people go.

In an API:

* Each **endpoint** (like `/predict`, `/users`, `/orders`) is like one counter.
* When an agent calls `POST /predict`, it is like going to the **prediction counter** and asking,
  “Here is my data. Please give me a result.”

FastAPI helps you define these “counters” very quickly.

---

#### 3. What will our `/predict` endpoint do?

To keep things simple, we will:

* Accept some **input data** (for example, a number called `x`).
* Do a very simple “prediction”: maybe `y = 2 * x`.
* Return that result as JSON: `{ "prediction": 10 }`.

Later, in your Autogen workflow:

* An agent can call this `/predict` endpoint.
* It sends input data.
* It gets back the prediction and uses it in its reasoning.

For now, just focus on **building the API**.

---

#### 4. Step-by-step: Creating a FastAPI server

**Step 1: Install FastAPI and Uvicorn**

In your terminal:

```bash
pip install fastapi uvicorn
```

**Step 2: Create a file `main.py`**

This will be your small FastAPI app.

```python
from fastapi import FastAPI
from pydantic import BaseModel

app = FastAPI()

# 1) Define the input data shape
class PredictRequest(BaseModel):
    x: float

# 2) Define the output data shape (optional but clean)
class PredictResponse(BaseModel):
    prediction: float

# 3) Create the /predict endpoint
@app.post("/predict", response_model=PredictResponse)
def predict(data: PredictRequest):
    """
    Very simple 'model':
    prediction = 2 * x
    """
    y = 2 * data.x
    return PredictResponse(prediction=y)

# 4) Optional: health check endpoint
@app.get("/health")
def health():
    return {"status": "ok"}
```

What this does:

* `PredictRequest` says: “I expect JSON input with a float field `x`.”
* `/predict` says: “I will receive that input, calculate `prediction = 2 * x`, and return it.”
* `PredictResponse` says: “My output will have one field: `prediction`.”

**Step 3: Run the server**

In your terminal:

```bash
uvicorn main:app --reload
```

Now your FastAPI server is running locally, usually at:

* `http://127.0.0.1:8000`

You can open:

* `http://127.0.0.1:8000/docs`

FastAPI will show you a simple web page to **test** the `/predict` endpoint.

---

#### 5. Calling `/predict` manually (like an agent would)

You can test it with a tool like **curl**, **Postman**, or any HTTP client.

Example using `curl`:

```bash
curl -X POST "http://127.0.0.1:8000/predict" \
  -H "Content-Type: application/json" \
  -d "{\"x\": 5}"
```

Expected response:

```json
{
  "prediction": 10.0
}
```

In your Autogen setup:

* An agent can be given a **tool** that does this HTTP call.
* From the agent’s point of view, it is just calling a function like `call_predict(x=5)`.
* Under the hood, that function sends data to `/predict` and returns the result.

So the **API endpoint becomes a tool** in your agentic system.

---

#### 6. How this fits into a bigger agent system

Real-life story:

Imagine you are building a **data engineering agent** that:

1. Reads a CSV file.
2. Cleans the data.
3. Sends a summary value (like average sales) to `/predict`.
4. Uses the prediction to suggest future stocking levels.

In that workflow:

* The agent does the **thinking** and **orchestration**.
* The `/predict` endpoint does the **core calculation/model**.
* If you later change the internal model (e.g., real ML model instead of `2 * x`),
  the agent’s logic can stay almost the same. It still just calls `/predict`.

This makes your system:

* **Modular** (logic and model separate)
* **Re-usable** (many agents can call the same endpoint)
* **Easy to upgrade** (swap out internal implementation).

---

#### 7. Takeaway

* Agents need **tools** to act in the real world.
* **APIs (like FastAPI endpoints)** are a clean way to expose these tools.
* A simple `/predict` endpoint can act as a **model service** for your agents.
* FastAPI makes it very easy to:

  * Define input and output formats.
  * Run a local server.
  * Scale later if needed.

If you understand this, you are ready to connect Autogen agents to real **backend services**.

---

#### 8. Codex Instruction Prompt for this Chapter

You can give this to Codex:

> “Generate a small FastAPI server in Python that exposes a POST /predict endpoint. It should accept JSON with one float field x, compute prediction = 2 * x, and return JSON with one field prediction. Add clear comments so a beginner can understand each part.”
