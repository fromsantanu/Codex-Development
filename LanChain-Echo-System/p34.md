# **Chapter 34. Docker Deployment**

### **1. Simple Introduction**

Once your agent (FastAPI + LangServe + LangChain code) is ready, you normally run it on your laptop.
But real systems need to run:

* On a cloud server
* On someone else’s machine
* Across multiple environments

To make this smooth and consistent, we “**containerize**” the agent using **Docker**.

A Docker container is like packing your entire app (code + Python + packages) inside a clean, sealed box.
Anywhere you run that box, it behaves exactly the same.

---

### **2. Real-Life Analogy**

Imagine you bake a cake at home.

If someone wants the *exact* same cake:

* You can’t control their kitchen
* You can’t control their oven
* You don’t know what ingredients they have

But… if you give them a **cake box** with everything already done, they just open and enjoy.

Docker is that cake box.

It makes sure:

* Your app runs the same
* No “works on my machine” issues
* Dependencies never mismatch

---

### **3. What We Want to Achieve**

* Pack the agent into a Docker image
* Run it anywhere (local or cloud)
* Avoid installing Python manually
* Avoid dependency problems
* Keep deployment simple

---

### **4. Simple Folder Structure**

```
my_agent/
   ├── agent.py
   ├── server.py
   ├── requirements.txt
   ├── Dockerfile
   └── .env   (optional, not copied to image by default)
```

---

### **5. Example: A Simple Agent**

```python
# agent.py
from langchain_openai import ChatOpenAI
from langchain.schema import HumanMessage

llm = ChatOpenAI(model="gpt-4o-mini")

async def run_agent(message: str):
    result = await llm.ainvoke([HumanMessage(content=message)])
    return result.content
```

And LangServe server:

```python
# server.py
from fastapi import FastAPI
from langserve import add_routes
from agent import run_agent

app = FastAPI()

add_routes(app, run_agent, path="/agent")
```

---

### **6. Create a Simple Dockerfile**

(This is the cleanest and simplest version.)

```dockerfile
# Use official Python image
FROM python:3.11-slim

# Set working directory
WORKDIR /app

# Copy project files
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# Copy all code
COPY . .

# Expose FastAPI port
EXPOSE 8000

# Start the server
CMD ["uvicorn", "server:app", "--host", "0.0.0.0", "--port", "8000"]
```

That’s it.
This creates a lightweight container ready for deployment.

---

### **7. Build the Docker Image**

Open your terminal in the project folder:

```bash
docker build -t my-agent:latest .
```

Docker reads your Dockerfile and creates the image.

---

### **8. Run the Container**

```bash
docker run -p 8000:8000 my-agent:latest
```

Now visit:

```
http://localhost:8000/agent?input=Hello
```

Your agent is running inside Docker.

---

### **9. Using Environment Variables (Optional but Important)**

If your agent uses:

* API keys
* Backend URLs
* JWT secrets

Use `.env` and pass it into Docker:

```bash
docker run --env-file .env -p 8000:8000 my-agent:latest
```

Docker container gets all your secrets safely through environment variables.

---

### **10. Testing the API**

Test with curl:

```bash
curl "http://localhost:8000/agent?input=Hello"
```

Or POST:

```bash
curl -X POST http://localhost:8000/agent \
  -H "Content-Type: application/json" \
  -d '{"input": "Generate a short summary"}'
```

---

### **11. Deploying to Cloud (Simple Overview)**

Once you have the container:

* Push to Docker Hub:

  ```bash
  docker tag my-agent mydockerhub/my-agent
  docker push mydockerhub/my-agent
  ```

* On cloud server (AWS, DigitalOcean, Google Cloud), run:

  ```bash
  docker pull mydockerhub/my-agent
  docker run -p 8000:8000 mydockerhub/my-agent
  ```

Your agent is now live on a cloud machine.

---

### **12. Common Issues & Fixes**

| Issue                                  | Cause                            | Fix                                         |
| -------------------------------------- | -------------------------------- | ------------------------------------------- |
| App crashes because `.env` missing     | Container doesn’t see local file | Use `--env-file .env`                       |
| “Module not found”                     | Missing in `requirements.txt`    | Rebuild image                               |
| Slow build                             | Using large Python base image    | Use `python:3.11-slim`                      |
| Port not reachable                     | Forgot to expose port            | Add `EXPOSE 8000`                           |
| “Works locally but fails in container” | Unpinned versions                | Add specific versions in `requirements.txt` |

---

### **13. Summary**

Docker makes your agent:

* Easy to ship
* Easy to run
* Easy to deploy
* Consistent across systems

You learned:

* How to containerize your agent
* How to write a simple Dockerfile
* How to run and test the container
* How to move it to the cloud

This is the standard way to deploy agentic workflows in real projects.

---

