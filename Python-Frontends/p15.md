# **Chapter 15. Using Codex to Generate and Refine Form Code**

---

## 1. Simple Introduction

Till now, you wrote form code **by hand** in Streamlit / Gradio / NiceGUI.

Now we will see how to let **Codex** act like a **fast junior developer** who:

* writes the **first version** of your form
* adds **more fields** when you ask
* adds **validation** rules
* connects the form to a **backend API**

You still stay the **main architect**.
Codex just helps you type code faster and cleaner.

We will focus on **NiceGUI** and a **“New Patient Registration”** form.

---

## 2. Real-Life Analogy

Imagine you are the **senior doctor** in a clinic.

* You decide **what to do**:
  “Create a patient registration form with these fields…”

* You have an **assistant** (Codex):
  The assistant writes the form, fills the details, but you check everything.

* Then you say:
  “Add validation.”
  “Connect this to our hospital system.”
  The assistant updates the form accordingly.

Codex is **that assistant**.
You give **clear instructions (prompts)**, Codex writes the **Python code**.

---

## 3. Key Concepts (Explained Gently)

### Prompt

A **prompt** is just a **text instruction** you give to Codex.

Example:

> “Generate a NiceGUI form for new patient registration with name, age, gender, phone, and address fields using ui.input and ui.select.”

Codex reads this and outputs **Python code**.

---

### Refinement

You don’t have to get everything perfect in one shot.

You can say:

* “Now add validation.”
* “Now connect the form to POST /patients/new API.”
* “Now make the layout cleaner using cards and columns.”

This is called **refining** the code.

---

### Review

Codex is powerful, but **not perfect**.

You must:

* read the code
* run it
* fix or adjust anything that is wrong

Think of Codex as a **very fast, but slightly careless colleague**.
You are the **final checker**.

---

## 4. Step-by-Step: Generating a Basic NiceGUI Form with Codex

### Step 1 – Write a Clear Prompt

Example prompt:

> “Generate a NiceGUI app in Python that shows a ‘New Patient Registration’ form inside a card.
> Use ui.input for:
>
> * Full Name
> * Age
> * Phone
>   Use ui.select for Gender with options: Male, Female, Other.
>   Add a Submit button that prints the collected data to the console.”

This is very clear:

* tells framework → **NiceGUI**
* tells fields → **which ones** and **types**
* tells layout → **inside a card**
* tells what to do on submit → **print data**

---

### Step 2 – Typical Codex Output (Example)

Codex might produce something like:

```python
from nicegui import ui

def submit():
    print('Name:', name.value)
    print('Age:', age.value)
    print('Gender:', gender.value)
    print('Phone:', phone.value)

with ui.card().classes('p-4'):
    ui.label('New Patient Registration')

    name = ui.input('Full Name')
    age = ui.input('Age')
    gender = ui.select(['Male', 'Female', 'Other'], label='Gender')
    phone = ui.input('Phone Number')

    ui.button('Submit', on_click=submit)

ui.run()
```

You then:

* copy this into your file
* run it
* adjust labels, classes, etc. if needed

---

## 5. Asking Codex to Add Validation

After you have the **basic form**, you ask Codex to **improve** it.

### Example Prompt – Add Validation

> “Improve this NiceGUI form code.
> Make Full Name, Gender, and Phone required.
> If any of these are empty on submit, show ui.notify with type='warning' and do not print data.
> If all fields are valid, show ui.notify with type='positive' and print data.”

Paste your existing form code under this prompt so Codex can **modify it**.

---

### Example Refined Code (Concept)

Codex might return:

```python
from nicegui import ui

def submit():
    if not name.value or not gender.value or not phone.value:
        ui.notify('Please fill all required fields', type='warning')
        return

    ui.notify('Patient data submitted', type='positive')
    print('Name:', name.value)
    print('Age:', age.value)
    print('Gender:', gender.value)
    print('Phone:', phone.value)

with ui.card().classes('p-4'):
    ui.label('New Patient Registration')

    name = ui.input('Full Name *')
    age = ui.input('Age')
    gender = ui.select(['Male', 'Female', 'Other'], label='Gender *')
    phone = ui.input('Phone Number *')

    ui.button('Submit', on_click=submit)

ui.run()
```

You can then:

* test
* tweak message texts
* maybe also check if **age is a number**, etc.

---

## 6. Asking Codex to Connect the Form to a Backend API

Now you want Codex to add **backend integration**.

Assume backend endpoint:

* URL: `http://localhost:8000/patients/new`
* Method: `POST`
* Body (JSON):

```json
{
  "name": "Rahul Das",
  "age": 42,
  "gender": "Male",
  "phone": "9999999999"
}
```

### Example Prompt – Connect to API

> “Modify this NiceGUI patient registration form so that on submit it sends a POST request to `http://localhost:8000/patients/new` using the requests library.
> Send JSON with keys: name, age, gender, phone.
> If the response status code is 201, show ui.notify with a success message.
> If not, show an error message with the status code.”

Paste your current form code after this prompt.

---

### Example Code with API Call (Concept)

Codex may generate:

```python
from nicegui import ui
import requests

def submit():
    if not name.value or not gender.value or not phone.value:
        ui.notify('Please fill all required fields', type='warning')
        return

    payload = {
        'name': name.value,
        'age': age.value,
        'gender': gender.value,
        'phone': phone.value,
    }

    try:
        response = requests.post(
            'http://localhost:8000/patients/new',
            json=payload,
            timeout=5
        )
        if response.status_code == 201:
            ui.notify('Patient registered successfully ✅', type='positive')
        else:
            ui.notify(f'Failed to register (code {response.status_code})', type='negative')
    except Exception as e:
        ui.notify(f'Error contacting server: {e}', type='negative')

with ui.card().classes('p-4'):
    ui.label('New Patient Registration')

    name = ui.input('Full Name *')
    age = ui.input('Age')
    gender = ui.select(['Male', 'Female', 'Other'], label='Gender *')
    phone = ui.input('Phone Number *')

    ui.button('Submit', on_click=submit)

ui.run()
```

You then:

* adjust field types (e.g., make age numeric)
* maybe log the response body
* maybe handle specific errors from backend

---

## 7. How Codex Helps You Here (Prompt Patterns)

Here are **ready-made prompts** you (or students) can copy and adapt.

### Prompt A – Generate First Version

> “Generate a NiceGUI app in Python with a card-based ‘New Patient Registration’ form.
> Use ui.input for name, age, phone, address, and ui.select for gender (Male, Female, Other).
> Add a Submit button that prints the values to the console.”

---

### Prompt B – Add Client-Side Validation

> “Take this NiceGUI form code and add validation so that name, gender, and phone are required.
> If any of them is missing, show ui.notify('Please fill all required fields', type='warning') and do not submit.”

---

### Prompt C – Connect to API Endpoint

> “Modify this NiceGUI form so that on submit it sends a POST request to `http://localhost:8000/patients/new` using the requests library.
> Send JSON with name, age, gender, phone, and address.
> If response status code is 201, show a success notification, otherwise show an error notification.”

---

### Prompt D – Use Async httpx

> “Convert this submit() function into an async function using httpx.AsyncClient in NiceGUI.
> Update the button to call the async function correctly.
> Keep the logic same for validation and notifications.”

---

### Prompt E – Clean Up Layout

> “Improve the layout of this NiceGUI form:
>
> * keep everything in a ui.card with padding
> * use ui.column for stacking fields
> * make inputs full-width with .classes('w-full')
> * keep the code simple and readable.”

---

## 8. Simple Architecture Diagram

```text
You (Developer)
      │
      ▼
Write Prompt for Codex
      │
      ▼
Codex Generates / Refines Form Code (NiceGUI)
      │
      ▼
Run Python App (NiceGUI frontend)
      │
      ▼
On Submit → Python function → requests / httpx
      │
      ▼
Backend API (FastAPI / other)
      │
      ▼
Database / Business Logic
```

You control the **top**, Codex helps with the **middle**, backend handles the **bottom**.

---

## 9. Mini Exercises for Students

### Exercise 1 – First Prompt

Write a prompt for Codex to generate a NiceGUI **“Doctor Registration”** form with:

* Name
* Specialization (select)
* Years of experience (input)
* Phone

Button: **“Register Doctor”**, just prints data for now.

---

### Exercise 2 – Add Validation via Codex

Ask Codex:

> “Update this Doctor Registration form so name and specialization are required, and years of experience must be a positive number. Use ui.notify for validation messages.”

Run and test.

---

### Exercise 3 – Connect to API

Assume endpoint:

* `POST http://localhost:8000/doctors/new`

Ask Codex to:

> “Modify this form so that on submit it posts data to /doctors/new using requests, and shows notifications based on response code.”

---

### Exercise 4 – Improve Layout

Ask Codex to:

> “Improve the layout of this NiceGUI form using ui.card, ui.column, and ui.row so that it looks organized. Keep the code simple.”

---

Whenever you are ready, you can give me the next chapter title, and I’ll continue in the same gentle, step-by-step style.
