# **Chapter 31 — Handling Sensitive Data Safely in the UI**

## **1. Simple Introduction**

Whenever your app deals with **login tokens**, **patient details**, **ID numbers**, or **financial information**, you must handle them very carefully.

The frontend should **not expose** sensitive information anywhere it doesn’t need to.
Even small mistakes—like printing a token in logs—can create security risks.

This chapter teaches you simple, practical rules to keep sensitive data safe in your Python frontends (Streamlit / NiceGUI / Gradio).

---

## **2. Real-Life Analogy**

Imagine someone gives you a **locker key** that opens a box full of important documents.

What should you do?

* You won’t show the key to others (→ don’t show token)
* You won’t take a photocopy of the key (→ don’t log token)
* You won’t leave it on the table (→ don’t store token in public storage)
* You might cover the key’s number partly when showing others (→ mask sensitive details)

That’s exactly how you must treat sensitive data in the UI.

---

## **3. Key Concepts (Explained Gently)**

### **a) Don’t log full tokens**

Never print tokens in:

* `print()`
* `st.write()`
* console logs
* browser console

Tokens grant full access. Logging them exposes them.

### **b) Don’t store tokens in public places**

Avoid storing tokens in:

* local files
* localStorage (browser)
* query parameters (URLs)
* downloadables
* cookies without security settings

Use:

* Streamlit’s `session_state`
* NiceGUI’s `ui.session`
* Gradio’s state variables

These live only in memory while the app is running.

### **c) Mask sensitive fields**

When showing sensitive data like Aadhaar, passport number, email, or partial IDs, show only a safe portion.

Example:

```
Aadhaar: **** **** 1234
Email: j***@gmail.com
Phone: 98******45
```

### **d) Avoid exposing internal errors**

Error messages should never reveal:

* backend stack traces
* internal database details
* SQL queries

Show user-friendly errors like:

> “Something went wrong. Please try again.”

---

## **4. Step-by-Step Explanation**

### **Step 1: Never print or display tokens**

Bad:

```python
print("User token:", token)
```

Good:

```python
print("Token received (masked).")
```

### **Step 2: Store tokens only in in-memory session**

Streamlit example:

```python
st.session_state.token = token
```

This disappears when the session closes.

### **Step 3: Mask IDs before showing**

Define a small helper:

```python
def mask_id(id_value):
    return "*" * (len(id_value) - 4) + id_value[-4:]
```

Use it like:

```python
st.write("Patient ID:", mask_id(patient_id))
```

### **Step 4: Avoid showing detailed backend errors**

Bad:

```
Error: SQLAlchemyError: connection failed at line 42…
```

Good:

```
Unable to fetch data. Please try again later.
```

### **Step 5: Protect sensitive UI elements**

If the app is public-facing:

* hide debug tools
* hide dev logs
* avoid showing tokens in URL parameters

Example of what NOT to do:

```
http://localhost:8501/?token=eyJhbGciOiJI...
```

---

## **5. Example UI Code (Streamlit)**

```python
import streamlit as st
import requests

BASE_URL = "http://localhost:8000"

if "token" not in st.session_state:
    st.session_state.token = None

def mask_id(id_string):
    return "*" * (len(id_string) - 4) + id_string[-4:]

def call_protected_api():
    if not st.session_state.token:
        st.warning("You are not logged in.")
        st.stop()

    headers = {"Authorization": f"Bearer {st.session_state.token}"}

    try:
        res = requests.get(f"{BASE_URL}/profile", headers=headers)
        if res.status_code == 200:
            data = res.json()
            masked_id = mask_id(data["user_id"])
            st.write("User ID:", masked_id)
        elif res.status_code == 401:
            st.error("Session expired.")
            st.session_state.token = None
        else:
            st.error("Unable to load data.")
    except:
        st.error("Network error.")
```

This approach ensures:

* Token is **never printed**
* User ID is **masked**
* Errors are **safe and simple**

---

## **6. Backend API Example (Simple)**

Backend should also avoid exposing sensitive data:

```python
@app.get("/profile")
def get_profile(current_user=Depends(auth_user)):
    # return only safe fields
    return {
        "name": "John Doe",
        "user_id": "ABCD12345678",   # frontend will mask it
        "role": "admin"
    }
```

---

## **7. How Codex Can Help Here**

### Sample prompts for Codex:

1. **“Mask this sensitive value before showing it on screen.”**
2. **“Review this code and remove any logging of tokens or passwords.”**
3. **“Improve security by ensuring tokens are kept only in memory.”**
4. **“Help me refactor this Streamlit login flow to avoid exposing sensitive fields.”**
5. **“Generate a utility function for masking Aadhaar, phone numbers, and emails.”**

Codex can also check your code for accidental leaks.

---

## **8. Mini Exercises for Students**

### **Exercise 1:**

Create a function to mask an email address like:

```
s****u@gmail.com
```

### **Exercise 2:**

Modify a login form so that:

* token is stored only in session state
* token is never printed or displayed

### **Exercise 3:**

Display a partially masked phone number from an API response.

### **Exercise 4:**

Show safe, user-friendly error messages for:

* Invalid token
* Expired token
* Network error

---
