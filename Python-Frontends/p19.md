# **Chapter 19. Building Charts from API Data**

## **1. Simple Introduction**

Charts help users **see patterns quickly**.
Numbers in a table are useful, but charts make trends clear.

In real apps, charts usually come from **API data**, not static files.
In this chapter youâ€™ll learn:

* how to call an API
* convert the data into lists or DataFrames
* show charts using **matplotlib** or **plotly** in Streamlit
* show charts in **NiceGUI**
* real-life examples like:

  * *Sales per month*
  * *Patients per disease category*

This is one of the most common tasks in dashboards.

---

## **2. Real-Life Analogy**

Imagine a **shop owner** looking at sales records.

* If he reads 365 rows of numbers, itâ€™s hard to understand.
* But if he sees one **bar chart** of monthly sales, he understands it instantly.

Charts are like **pictures of information**.
They tell the story in one glance.

---

## **3. Key Concepts (Explained Gently)**

### âœ”ï¸ API Data for Charts

Backend sends data like:

```json
{
  "months": ["Jan", "Feb", "Mar"],
  "sales": [1200, 1500, 1800]
}
```

or

```json
[
  {"disease": "Fever", "count": 40},
  {"disease": "Dengue",  "count": 25}
]
```

The frontend converts this into chart-friendly lists.

---

### âœ”ï¸ Matplotlib

* Simple charting library.
* Good for basic plots.

---

### âœ”ï¸ Plotly

* Interactive charts.
* Can hover, zoom, and highlight data.
* Works beautifully with Streamlit and NiceGUI.

---

### âœ”ï¸ NiceGUI Chart Options

* Plotly
* ECharts
* Matplotlib (display as image)

NiceGUI is flexible.

---

### âœ”ï¸ Typical Chart Types

* **Bar chart** â†’ comparing categories
* **Line chart** â†’ trend over time
* **Pie chart** â†’ proportion of categories
* **Scatter plot** â†’ relationship between two numbers

---

## **4. Step-by-Step Explanation**

### **Step 1: Call the API**

Use `requests.get()` with optional query parameters.

---

### **Step 2: Parse JSON**

Convert JSON into lists or DataFrame.

---

### **Step 3: Choose Chart Type**

Examples:

* Bar chart for â€œpatients per diseaseâ€
* Line chart for â€œsales per monthâ€

---

### **Step 4: Build Chart**

Using matplotlib or plotly.

---

### **Step 5: Display Chart**

In Streamlit or NiceGUI.

---

### **Step 6: Handle Empty or Error Cases**

If API fails:

* show a simple error message
* show fallback data

---

## **5. Example UI Code â€“ Streamlit (Plotly)**

### ğŸ”¹ Example: Sales per Month

```python
import streamlit as st
import requests
import plotly.express as px
import pandas as pd

st.title("Sales Per Month Chart")

# --- Fetch API data ---
response = requests.get("http://localhost:8000/sales/monthly")
data = response.json()    # {"months": [...], "sales": [...]}

df = pd.DataFrame({
    "Month": data["months"],
    "Sales": data["sales"]
})

# --- Create bar chart ---
fig = px.bar(df, x="Month", y="Sales", title="Monthly Sales")
st.plotly_chart(fig, use_container_width=True)
```

---

### ğŸ”¹ Example: Patients per Disease Category (Matplotlib)

```python
import streamlit as st
import requests
import matplotlib.pyplot as plt

st.title("Patients by Disease Category")

# API call
response = requests.get("http://localhost:8000/patients/disease-count")
disease_data = response.json()
# [{"disease": "Fever", "count": 40}, ...]

labels = [item["disease"] for item in disease_data]
counts = [item["count"] for item in disease_data]

# Matplotlib chart
fig, ax = plt.subplots()
ax.bar(labels, counts)
ax.set_ylabel("Patients")
ax.set_title("Disease Category Count")
plt.xticks(rotation=45)

st.pyplot(fig)
```

---

## **5b. Example UI Code â€“ NiceGUI (Plotly)**

### ğŸ”¹ Bar Chart in NiceGUI

```python
from nicegui import ui
import requests
import plotly.express as px

# --- API call ---
data = requests.get("http://localhost:8000/sales/monthly").json()
df = {
    "months": data["months"],
    "sales": data["sales"]
}

fig = px.line(df, x="months", y="sales", title="Monthly Sales Trend")

ui.label("Sales Chart")
ui.plotly(fig)

ui.run()
```

---

### ğŸ”¹ Pie Chart: Patients per Disease

```python
from nicegui import ui
import requests
import plotly.express as px

data = requests.get("http://localhost:8000/patients/disease-count").json()

diseases = [d["disease"] for d in data]
counts = [d["count"] for d in data]

fig = px.pie(
    names=diseases,
    values=counts,
    title="Patients per Disease Category"
)

ui.label("Disease Distribution")
ui.plotly(fig)

ui.run()
```

---

## **6. Backend API Example**

### **Sales API**

```
GET /sales/monthly
```

**Response**

```json
{
  "months": ["Jan", "Feb", "Mar", "Apr"],
  "sales": [200, 350, 500, 420]
}
```

---

### **Disease Category API**

```
GET /patients/disease-count
```

**Response**

```json
[
  {"disease": "Fever", "count": 40},
  {"disease": "Dengue", "count": 25},
  {"disease": "Malaria", "count": 10}
]
```

---

## **7. How Codex Helps You Here**

Some ready prompts:

### âœ”ï¸ Prompt 1 â€“ Generate a Streamlit chart

> â€œCodex, create a Streamlit page that calls `/sales/monthly` and draws a bar chart using plotly.â€

### âœ”ï¸ Prompt 2 â€“ Add dropdown filters

> â€œCodex, add a dropdown for selecting year and update the chart based on selected year by calling the API again.â€

### âœ”ï¸ Prompt 3 â€“ Handle API errors

> â€œCodex, modify this code so it catches API timeouts and shows `No data available` gracefully.â€

### âœ”ï¸ Prompt 4 â€“ Convert Streamlit chart to NiceGUI

> â€œCodex, convert this Streamlit plotly chart into a NiceGUI page using `ui.plotly`.â€

### âœ”ï¸ Prompt 5 â€“ Multiple charts in one screen

> â€œCodex, generate a Clean dashboard with two charts side by side fetched from two different APIs.â€

---

## **8. Mini Exercises for Students**

### ğŸŸ¦ Exercise 1 â€“ Simple Chart from API

Create a Streamlit app that:

* calls `/orders/daily-count`
* shows a **line chart** of orders each day

---

### ğŸŸ¦ Exercise 2 â€“ Category Bar Chart

Create a NiceGUI page that:

* calls `/products/category-count`
* shows a **bar chart** with plotly

---

### ğŸŸ¦ Exercise 3 â€“ Add Filters

Extend Exercise 2:

* add a dropdown for selecting a `year`
* call `/products/category-count?year=2024`

---

### ğŸŸ¦ Exercise 4 â€“ Two Charts

Make a page with:

* â€œSales per monthâ€
* â€œReturns per monthâ€

Side by side.

---
