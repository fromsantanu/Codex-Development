# **Chapter 11. Building Forms in Streamlit**

---

## 1. Simple Introduction

In this chapter, we will build real forms using **Streamlit**.

Streamlit lets you make web pages using **only Python**.
You don’t need HTML, CSS, or JavaScript.

We will learn:

* How to show **text boxes**, **dropdowns**, **date pickers**, etc.
* How to **submit** the form.
* How to call a **backend API** when the user clicks Submit.
* How to show **success** or **error** messages.

We’ll continue with our example of a **“New Patient Registration”** form.

---

## 2. Real-Life Analogy

Think of **Streamlit** as a **smart reception table**:

* You put **fields** on the table: Name, Age, Gender, Visit Date.
* The patient fills these fields.
* When they click **Submit**, the receptionist sends this information to the **backend system** (like the hospital computer).

Streamlit is that “reception desk” on the screen.

---

## 3. Key Concepts (Explained Gently)

### `st.text_input`

A **text box** where the user can type something (name, phone, etc.).

```python
name = st.text_input("Full Name")
```

---

### `st.selectbox`

A **dropdown** list where the user selects **one** value.

```python
gender = st.selectbox("Gender", ["Male", "Female", "Other"])
```

---

### `st.date_input`

A **calendar** where the user can pick a date.

```python
dob = st.date_input("Date of Birth")
```

---

### Forms in Streamlit

Streamlit has a special block for forms:

```python
with st.form("patient_form"):
    # inputs here
    submitted = st.form_submit_button("Submit")
```

* All inputs inside `with st.form()` belong to the same form.
* When the user clicks **Submit**, `submitted` becomes `True`.

---

### Success & Error Messages

* `st.success("Saved!")` → green box
* `st.error("Something went wrong")` → red box
* `st.warning("Please fill all required fields")` → yellow box
* `st.info("This is some information")` → blue box

---

## 4. Step-by-Step: Building a Patient Form in Streamlit

### Step 1 – Import Streamlit

```python
import streamlit as st
```

---

### Step 2 – Create the Form Layout

We put our inputs inside a `form` block:

```python
with st.form("patient_registration_form"):
    st.header("New Patient Registration")

    name = st.text_input("Full Name *")
    age = st.number_input("Age *", min_value=0, max_value=120, step=1)
    gender = st.selectbox("Gender *", ["Male", "Female", "Other"])
    dob = st.date_input("Date of Birth")
    phone = st.text_input("Phone Number *")

    # Submit button
    submitted = st.form_submit_button("Submit")
```

---

### Step 3 – Validate Required Fields

After the form block, we check if the button was clicked:

```python
if submitted:
    if not name or not phone:
        st.error("Please fill all required (*) fields.")
    else:
        st.success("Form is valid! (Next: send to backend)")
```

---

### Step 4 – Call Backend API on Submit

We usually use the `requests` library:

```python
import requests

if submitted:
    if not name or not phone:
        st.error("Please fill all required (*) fields.")
    else:
        payload = {
            "name": name,
            "age": int(age),
            "gender": gender,
            "dob": str(dob),
            "phone": phone,
        }

        try:
            response = requests.post(
                "http://localhost:8000/patients/new",
                json=payload,
                timeout=5
            )

            if response.status_code == 201:
                st.success("Patient registered successfully!")
            else:
                st.error(f"Backend error: {response.status_code}")
        except Exception as e:
            st.error(f"Could not reach backend: {e}")
```

---

## 5. Full Example: Streamlit Patient Registration Form

Here is a complete small app:

```python
import streamlit as st
import requests

st.title("Clinic – New Patient Registration")

with st.form("patient_registration_form"):
    st.subheader("Patient Details")

    name = st.text_input("Full Name *")
    age = st.number_input("Age *", min_value=0, max_value=120, step=1)
    gender = st.selectbox("Gender *", ["Male", "Female", "Other"])
    dob = st.date_input("Date of Birth")
    phone = st.text_input("Phone Number *")
    address = st.text_area("Address (optional)")

    submitted = st.form_submit_button("Submit")

if submitted:
    if not name or not phone:
        st.error("Please fill all required (*) fields.")
    else:
        payload = {
            "name": name,
            "age": int(age),
            "gender": gender,
            "dob": str(dob),
            "phone": phone,
            "address": address,
        }

        st.info("Sending data to backend...")

        try:
            response = requests.post(
                "http://localhost:8000/patients/new",
                json=payload,
                timeout=5
            )

            if response.status_code == 201:
                st.success("✅ Patient registered successfully!")
            else:
                st.error(f"❌ Backend error: {response.status_code}")
        except Exception as e:
            st.error(f"❌ Could not reach backend: {e}")
```

---

## 6. Simple Architecture Diagram

```text
User (Browser)
      │
      ▼
Streamlit App (Form)
      │   JSON (patient data)
      ▼
Backend API (FastAPI / Django / etc.)
      │
      ▼
Database (MySQL / PostgreSQL)
```

---

## 7. How Codex Can Help Here

You can ask Codex to build and improve these forms for you.

### Sample Prompt 1 – Basic Form

> “Write a Streamlit app with a form for new patient registration.
> Include fields for name, age, gender (dropdown), date of birth, and phone number.
> Use st.form and st.form_submit_button.”

---

### Sample Prompt 2 – Add Validation

> “Take this Streamlit form code and add validation so that name, age, and phone are required.
> Show st.error messages if they are missing.”

---

### Sample Prompt 3 – Connect to Backend

> “Modify this Streamlit form so that on submit it calls a FastAPI endpoint at `http://localhost:8000/patients/new` using requests.post and shows success or error messages.”

---

### Sample Prompt 4 – Better Layout

> “Improve the layout of this Streamlit patient form: group fields in two columns, add a title and section headers, and make the app look cleaner.”

---

### Sample Prompt 5 – Add More Fields

> “Extend this Streamlit patient registration form to include a selectbox for blood group and a textarea for medical history.”

---

## 8. Mini Exercises for Students

Try these small tasks one by one:

### Exercise 1 – Add More Fields

Add two more fields to the form:

* **Blood Group** (selectbox: A+, A−, B+, B−, O+, O−, AB+, AB−)
* **Email** (text input)

---

### Exercise 2 – Add a “Visit Date”

Use `st.date_input` to capture **First Visit Date**.

---

### Exercise 3 – Simple Local “Save”

Instead of calling a real backend, just show the submitted data using `st.json(payload)` when the form is valid.

---

### Exercise 4 – Fake Error Handling

Simulate an error:

* If age > 100, show `st.warning("Please check age again.")`
* If phone number is shorter than 10 digits, show `st.error("Phone number too short.")`

---
