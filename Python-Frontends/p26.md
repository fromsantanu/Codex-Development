# **Chapter 26. User Roles & Conditional UI (Admin vs Normal User)**

We’ll use **Streamlit** in this chapter.

---

## **1. Simple Introduction**

In real applications, **not every user should see the same screen**.

Example in a clinic:

* **Doctor** can see medical history, write prescriptions, approve reports.
* **Receptionist** can register patients, schedule appointments, but **cannot** change prescriptions.
* **Admin** can manage users, system settings, billing.

So the **frontend UI must change** based on **who is logged in**.

This is called **role-based UI** or **conditional UI**.

---

## **2. Real-Life Analogy**

Think of a **hospital building** with different rooms:

* **Doctors’ room** – only doctors and nurses allowed
* **Admin office** – only admins and management
* **Reception** – open to staff and patients

Each person has a **badge** (ID card) that defines their **role**:

* Doctor badge
* Reception badge
* Admin badge

The guard checks your badge and decides:

> “You can enter here” or “You cannot enter here”.

In the same way:

* Your frontend checks the **user’s role**
* Shows or hides **buttons/menus/pages** accordingly

---

## **3. Key Concepts (Explained Gently)**

### **a) User Role**

A simple label given to a user, for example:

* `"doctor"`
* `"receptionist"`
* `"admin"`
* `"patient"`

This role is usually sent from the backend after login.

---

### **b) JWT (JSON Web Token)** – Very Simple Idea

JWT is like a **signed pass** from the server.

It usually contains:

* user id
* role
* expiry time

Frontend stores this token (in session state or cookies) and sends it with each API call.

We don’t go deep into JWT internals here; we just treat it like a **bag of info** that backend sends.

---

### **c) Session Info in Frontend**

After login, we store:

* `st.session_state["token"]`
* `st.session_state["role"]`
* `st.session_state["user_name"]`

Then in the UI, we check:

```python
if st.session_state.role == "doctor":
    # show doctor features
```

This is conditional UI.

---

### **d) Hiding Admin Pages**

We can:

* hide some pages in sidebar
* hide some buttons
* show a message like “Access denied”

Remember: **real security** must still be enforced in the **backend**.
Frontend hiding is just for **UX**, not real protection.

---

## **4. Step-by-Step Explanation**

### **Step 1: Login and Get Role from Backend**

User enters username/password.

Backend checks and returns:

* token
* role
* name

---

### **Step 2: Save This Info in Session State**

Example:

```python
st.session_state.token = response["token"]
st.session_state.role = response["role"]
st.session_state.user_name = response["name"]
```

---

### **Step 3: Build Menu Based on Role**

* Doctor sees: **Dashboard, Patients, Prescriptions**
* Receptionist sees: **Dashboard, Patient Registration, Appointments**
* Admin sees: **All above + Admin Panel**

---

### **Step 4: Show / Hide Content**

When drawing UI, check role:

```python
if st.session_state.role == "admin":
    # show admin actions
```

---

### **Step 5: Protect Sensitive Actions**

Even if button is hidden, a clever user might call your API directly.

So the **backend** must also check the role before performing dangerous actions (like deleting users).

---

## **5. Example UI Code (Using Streamlit)**

### **A Simple Role-Based UI**

Here we simulate login with a dropdown (for demo).
In real life, you’ll call a login API.

```python
import streamlit as st

st.set_page_config(page_title="Role-based UI Demo", layout="wide")

st.title("Clinic App – Role-based UI Example")

# ----- 1. Simulated login (for demo only) -----
if "role" not in st.session_state:
    st.session_state.role = None
    st.session_state.user_name = None

if st.session_state.role is None:
    st.subheader("Login (Demo)")

    user_name = st.text_input("User name")
    selected_role = st.selectbox("Select role (demo)", ["doctor", "receptionist", "admin"])

    if st.button("Login"):
        # In real app, you'd call backend /login here
        st.session_state.user_name = user_name or "Guest"
        st.session_state.role = selected_role
        st.success(f"Logged in as {st.session_state.user_name} ({st.session_state.role})")
        st.experimental_rerun()
else:
    st.write(f"Logged in as **{st.session_state.user_name}** ({st.session_state.role})")
    if st.button("Logout"):
        st.session_state.role = None
        st.session_state.user_name = None
        st.experimental_rerun()

# If not logged in, stop here
if st.session_state.role is None:
    st.stop()

# ----- 2. Sidebar menu changes by role -----
st.sidebar.title("Main Menu")

role = st.session_state.role

if role == "doctor":
    page = st.sidebar.radio("Go to", ["Dashboard", "My Patients", "Prescriptions"])
elif role == "receptionist":
    page = st.sidebar.radio("Go to", ["Dashboard", "Register Patient", "Appointments"])
elif role == "admin":
    page = st.sidebar.radio("Go to", ["Dashboard", "Users", "System Settings", "Reports"])
else:
    page = st.sidebar.radio("Go to", ["Dashboard"])

# ----- 3. Page content based on role + page -----
st.header(page)

if page == "Dashboard":
    st.write("Show overall clinic summary here.")

if role == "doctor":
    if page == "My Patients":
        st.write("Doctor: list of assigned patients.")
    elif page == "Prescriptions":
        st.write("Doctor: create and view prescriptions.")

if role == "receptionist":
    if page == "Register Patient":
        st.write("Receptionist: form to register new patients.")
    elif page == "Appointments":
        st.write("Receptionist: manage appointment schedule.")

if role == "admin":
    if page == "Users":
        st.write("Admin: manage users, roles, and permissions.")
    elif page == "System Settings":
        st.write("Admin: change system configuration.")
    elif page == "Reports":
        st.write("Admin: see billing, usage, and performance reports.")
```

This simple app:

* “logs in” as doctor/receptionist/admin
* shows a **different sidebar menu** depending on the role
* displays different content per role

---

## **6. Backend API Example (Simple)**

### **Login Request**

```json
POST /login
{
  "username": "dr_roy",
  "password": "secret123"
}
```

### **Login Response (with JWT and role)**

```json
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "user": {
    "id": 12,
    "name": "Dr. Roy",
    "role": "doctor"
  }
}
```

Frontend after login:

```python
st.session_state.token = data["token"]
st.session_state.role = data["user"]["role"]
st.session_state.user_name = data["user"]["name"]
```

### **Calling a Protected API**

When calling backend:

```python
import requests

headers = {
    "Authorization": f"Bearer {st.session_state.token}"
}

response = requests.get("https://api.my-clinic.com/patients", headers=headers)
```

Backend checks the token and role:

* If role = `"doctor"` → allow
* If role = `"receptionist"` → maybe allow read-only
* If not allowed → return 403 Forbidden

---

## **7. How Codex Can Help You Here**

Here are some ready-made prompts:

### **Prompt 1**

“Generate a Streamlit clinic dashboard where the sidebar menu changes based on user role: doctor, receptionist, and admin.”

### **Prompt 2**

“Create a Streamlit login page that calls a /login API, stores token and role in session_state, and shows different buttons for admin vs normal user.”

### **Prompt 3**

“Rewrite my Streamlit multi-page code to hide admin pages for non-admin users using role in session_state.”

### **Prompt 4**

“Generate Python requests code to call a backend /patients endpoint using a JWT token stored in session_state.”

### **Prompt 5**

“Analyze my role-based UI logic and suggest a cleaner way to organize doctor, receptionist, and admin menus.”

---

## **8. Small Text Diagram**

```text
          ┌──────────────┐
          │   Login UI    │
          └──────┬────────┘
                 │ sends username/password
                 ▼
          ┌──────────────┐
          │  Backend API │
          └──────┬────────┘
         returns │ token + role
                 ▼
       ┌─────────────────────┐
       │  Frontend Session   │
       │ token, role, name   │
       └──────┬──────────────┘
              │
              ▼
   Conditional UI (role-based)
   - Doctor menu
   - Reception menu
   - Admin menu
```

---

## **9. Mini Exercises for Students**

### **Exercise 1 – Role-Based Buttons**

Create a Streamlit app:

* Simulate login with roles: `"doctor"`, `"receptionist"`.
* If role is doctor → show button “Write Prescription”.
* If role is receptionist → show button “Register Patient”.

Only one of these should be visible based on role.

---

### **Exercise 2 – Hide Admin Menu**

Add a third role `"admin"`:

* Admin sees extra sidebar item: “Admin Panel”.
* Doctor and receptionist do **not** see it.

For non-admin users who try to manually open Admin Panel (you can simulate with a variable), show “Access denied”.

---

### **Exercise 3 – Combine With Token**

Simulate:

* a `fake_token` string for each user
* store it in `st.session_state.token`
* print it at the bottom of the page to understand how token travels

Later you can replace this with a real backend call.

---
