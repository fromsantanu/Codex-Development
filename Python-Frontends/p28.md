# **Chapter 28 — Login and Token Basics**

## **1. Simple Introduction**

When a user logs into a system, the backend needs a way to remember **who the user is** for the next actions.
A simple username-password check is not enough.

So we use something called a **token**.
Think of it like a small card the server gives you after confirming your identity.
You show this card each time you make another request.

The most common format is **JWT** (JSON Web Token).

---

## **2. Real-Life Analogy**

Imagine entering an office building:

1. You show your ID at the reception.
2. Reception verifies you.
3. They give you a **signed entry pass**.
4. You use this pass to enter different rooms.

JWT works exactly like this:

* Login = showing ID
* Server = reception
* JWT token = signed entry pass
* Using API = entering rooms

---

## **3. Key Concepts (Explained Gently)**

### **a) JWT Token**

A small text string containing user details, signed by the server so nobody can change it.

### **b) Login API**

You send username + password → server checks → sends back a token.

### **c) Sending Token in Other Requests**

The frontend must attach the token in the headers:

```
Authorization: Bearer <token>
```

### **d) Logout**

There is no “delete token” in backend.
You simply **remove the token** from the browser/frontend.
Once removed, user becomes “logged out”.

---

## **4. Step-by-Step Explanation**

### **Step 1: User enters login details**

Email + password.

### **Step 2: Frontend sends them to backend**

A simple POST request to `/login`.

### **Step 3: Backend checks correctness**

If correct → backend creates a token.

### **Step 4: Backend sends the token back**

Frontend stores it (in memory / session state).

### **Step 5: Frontend attaches token in all future requests**

Every API call includes the token.

### **Step 6: Logout = delete token from frontend**

Once token is removed → user cannot call protected APIs → logout done.

---

## **5. Example UI Code (Streamlit)**

```python
import streamlit as st
import requests

BASE_URL = "http://localhost:8000"

# Store token using Streamlit session state
if "token" not in st.session_state:
    st.session_state.token = None

st.title("Login Example")

# If not logged in
if not st.session_state.token:

    username = st.text_input("Username")
    password = st.text_input("Password", type="password")

    if st.button("Login"):
        res = requests.post(f"{BASE_URL}/login", json={
            "username": username,
            "password": password
        })

        if res.status_code == 200:
            st.session_state.token = res.json()["token"]
            st.success("Logged in!")
        else:
            st.error("Invalid login")

else:
    st.success("You are logged in!")
    if st.button("Logout"):
        st.session_state.token = None
        st.info("Logged out!")
```

---

## **6. Backend API Example (Very Simple)**

### **Login API**

```python
# FastAPI example

from fastapi import FastAPI
from pydantic import BaseModel
import jwt

SECRET = "mysecret"

app = FastAPI()

class Login(BaseModel):
    username: str
    password: str

@app.post("/login")
def login(data: Login):
    if data.username == "admin" and data.password == "123":
        token = jwt.encode({"user": data.username}, SECRET, algorithm="HS256")
        return {"token": token}
    return {"error": "Invalid credentials"}
```

### **Protected API**

```python
from fastapi import Header, HTTPException

@app.get("/profile")
def profile(authorization: str = Header(None)):
    if not authorization:
        raise HTTPException(status_code=401, detail="No token provided")

    token = authorization.split(" ")[1]
    
    try:
        data = jwt.decode(token, SECRET, algorithms=["HS256"])
        return {"message": "Welcome!", "user": data["user"]}
    except:
        raise HTTPException(status_code=401, detail="Invalid token")
```

---

## **7. How Codex Can Help Here**

**Sample prompts you can use in Codex:**

1. **“Generate a FastAPI login endpoint that returns a JWT token.”**
2. **“Add a protected route that checks for JWT in the Authorization header.”**
3. **“Improve my Streamlit login form and store the token in session_state.”**
4. **“Create a simple logout mechanism by clearing session data.”**
5. **“Explain the JWT structure and show how to decode it on the frontend.”**

Codex can write the boilerplate code for you and fix token handling mistakes.

---

## **8. Mini Exercises for Students**

1. **Create a login page in Streamlit** with username + password.
2. **Call a protected API** after login and show a welcome message.
3. **Add a logout button** that resets the stored token.
4. **Create a small dashboard page** that only appears after login.

---
