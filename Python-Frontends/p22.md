# **Chapter 22. State in Frontends – Remembering Things Between Actions**

## **1. Simple Introduction**

In a frontend app, we often need the screen to **“remember something”** when the user clicks buttons, changes pages, or refreshes part of the UI.

For example:

* A **shopping cart** must remember which items the user added.
* A **dashboard** must remember the selected **date filters**.
* A **patient app** must remember who is **logged in**.
* A form must remember the **last selected item** even after the screen refreshes.

This “remembering ability” is called **state**.

---

## **2. Real-Life Analogy**

Think of a **shop counter**.

You take a biscuit packet, put it on the counter, then go to bring chips.
The shopkeeper **does not forget** the biscuit packet.
He keeps it aside until you finish shopping.

This is exactly what **state** does for your UI.

---

## **3. Key Concepts (Explained Gently)**

### **a) Local Variables**

These are normal Python variables inside your code.

**Problem:**
They get reset every time the UI refreshes.

---

### **b) Session State**

This is a special memory area the frontend keeps for the whole **session** of the user.

It remembers values such as:

* selected items
* login token
* filters
* last page number
* dark/light mode choice

Even when parts of UI refresh.

---

### **c) Why State Matters**

Without state, the user experience becomes painful:

* Shopping cart clears on every click
* Filters reset
* Forms lose values
* Logged-in session disappears

---

## **4. Step-by-Step Explanation**

### **Step 1: Identify what must be remembered**

Ask: *“If the page refreshes, what values should not disappear?”*

Examples:

* Selected product
* Date range filter
* Logged-in user ID
* Items in cart

---

### **Step 2: Store that in Session State**

Most Python UI tools give built-in session objects.

Streamlit → `st.session_state`
NiceGUI → `ui.storage`
Gradio → `gr.State()`

---

### **Step 3: Update session values only when needed**

This prevents accidental resetting.

---

### **Step 4: Use session values to build the UI**

For example, when building a cart UI, read from session state to show the items.

---

## **5. Example UI Code (Using Streamlit)**

### **Shopping Cart Example**

```python
import streamlit as st

st.title("Simple Shopping Cart")

# Step 1: initialize state only once
if "cart" not in st.session_state:
    st.session_state.cart = []

# Step 2: product selection
product = st.selectbox("Choose a product", ["Apple", "Banana", "Orange"])

if st.button("Add to cart"):
    st.session_state.cart.append(product)
    st.success(f"{product} added!")

# Step 3: show cart
st.write("Your Cart:", st.session_state.cart)
```

**Explanation:**
Even if the user interacts with the screen multiple times, the **cart** list keeps its items.

---

### **Remembering Filters Example**

```python
import streamlit as st

if "selected_year" not in st.session_state:
    st.session_state.selected_year = 2024

st.session_state.selected_year = st.selectbox(
    "Year filter",
    [2022, 2023, 2024, 2025],
    index=[2022, 2023, 2024, 2025].index(st.session_state.selected_year)
)

st.write("Showing data for:", st.session_state.selected_year)
```

---

## **6. Backend API Example (Simple)**

Example: saving the `logged_in_user` in session state after calling login API.

### **Frontend → Backend Login Request**

```json
POST /login
{
  "username": "santanu",
  "password": "12345"
}
```

### **Backend → Frontend Response**

```json
{
  "user_id": 101,
  "token": "abc123xyz"
}
```

### **Store It**

```python
st.session_state.user_id = response.json()["user_id"]
st.session_state.token = response.json()["token"]
```

---

## **7. How Codex Can Help Here**

Here are some ready-made prompts:

### **Prompt 1**

“Generate a Streamlit example that uses session_state to store a shopping cart with add and remove buttons.”

### **Prompt 2**

“Fix my code: session_state is resetting on every button click. Help me restructure it.”

### **Prompt 3**

“Create a NiceGUI example where ui.storage remembers the selected patient ID.”

### **Prompt 4**

“Generate a login screen that stores token and user info in session_state.”

### **Prompt 5**

“Optimize my state handling logic so filters and dropdown selections don’t reset.”

---

## **8. Mini Exercises for Students**

### **Exercise 1**

Create a Streamlit app that remembers:

* username entered in a text box
* last selected color from a dropdown

Show them below the UI.

---

### **Exercise 2**

Make a small “favorite items” list:

* Add item button
* Remove item button
* Store everything in session state

---

### **Exercise 3**

Build a filter UI with:

* “start date”
* “end date”
* “category filter”

Make these values persist using session state.

---
