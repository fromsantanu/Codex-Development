# **Chapter 7. Using Python to Call REST APIs**

## **1. Simple Introduction**

Frontend apps often need to “talk” to a backend server.
Python makes this very easy. You can use:

* **requests** → normal, step-by-step calls (sync)
* **httpx / aiohttp** → fast, non-blocking calls (async)

This chapter explains these in very simple language with easy examples.

---

## **2. Real-Life Analogy**

Think of an API call like making a phone call to a shop:

* **requests** = making one call at a time
  (You dial → wait → get response)

* **async calls (httpx / aiohttp)** = making many calls together
  (You dial several shops at once → everything comes back together)

Sync calls = slow but simple
Async calls = fast when you need many calls

---

## **3. Key Concepts (Explained Gently)**

### **1) Sync API calls**

You wait for one response before making the next request.

### **2) Async API calls**

You don’t wait.
You send many requests and Python collects the results whenever they return.

### **3) Handling errors**

APIs may fail.
You must check:

* status code
* timeout
* wrong URL
* invalid JSON

### **4) Timeout**

Tells Python how long to wait before giving up.
Useful when the server is slow.

---

## **4. Step-by-Step Explanation**

### **Step 1: Import the package**

For sync calls: `import requests`
For async calls: `import httpx` or `import aiohttp`

### **Step 2: Call the API**

Use GET/POST/PUT/DELETE based on your need.

### **Step 3: Check status**

If it is `200` or `201` → OK
Else → handle error

### **Step 4: Parse JSON**

Convert response into Python objects.

### **Step 5: Handle exceptions**

Use `try-except`.

---

## **5. Sync API Calls Using `requests`**

### **Simple GET request**

```python
import requests

url = "https://dummyjson.com/products/1"

try:
    response = requests.get(url, timeout=5)

    if response.status_code == 200:
        data = response.json()
        print("Product:", data["title"])
    else:
        print("Error:", response.status_code)

except requests.exceptions.Timeout:
    print("The request took too long!")
except Exception as e:
    print("Something went wrong:", e)
```

### **Simple POST request**

```python
import requests

payload = {"name": "Fan", "price": 1200}

response = requests.post(
    "https://httpbin.org/post",
    json=payload,
    timeout=5
)

print(response.json())
```

---

## **6. Async API Calls (Using httpx)**

(Explained in very simple language)

Async = “send many requests together and wait once”.

### **Basic Example**

```python
import asyncio
import httpx

async def fetch_product():
    async with httpx.AsyncClient(timeout=5) as client:
        res = await client.get("https://dummyjson.com/products/2")

        if res.status_code == 200:
            print(res.json())
        else:
            print("Error:", res.status_code)

asyncio.run(fetch_product())
```

### **Multiple async calls together**

```python
import asyncio
import httpx

urls = [
    "https://dummyjson.com/products/1",
    "https://dummyjson.com/products/2",
    "https://dummyjson.com/products/3",
]

async def fetch_all():
    async with httpx.AsyncClient(timeout=5) as client:
        tasks = [client.get(url) for url in urls]
        results = await asyncio.gather(*tasks)

        for r in results:
            print(r.status_code, r.json()["title"])

asyncio.run(fetch_all())
```

This is much faster than calling one by one.

---

## **7. Async API Calls Using aiohttp (Very Simple Version)**

```python
import asyncio
import aiohttp

async def get_user():
    async with aiohttp.ClientSession() as session:
        async with session.get("https://dummyjson.com/users/1") as res:
            data = await res.json()
            print(data)

asyncio.run(get_user())
```

---

## **8. Handling Errors and Timeouts (Simple Language)**

### **What can go wrong?**

* Server not responding
* Wrong URL
* Internet problem
* Bad JSON
* Timeout

### **Safe pattern**

```python
import requests

try:
    res = requests.get("https://dummyjson.com/unknown", timeout=3)

    if res.status_code == 404:
        print("Not found!")
    elif res.status_code == 200:
        print("OK:", res.json())
    else:
        print("Error:", res.status_code)

except requests.exceptions.Timeout:
    print("Server did not reply in time!")
except Exception as e:
    print("Unexpected problem:", e)
```

---

## **9. How Codex Can Help You Here**

### **Useful prompts**

1. **“Codex, generate Python code to call a REST API using requests and handle errors gracefully.”**
2. **“Codex, write an async httpx example with multiple API calls and print results.”**
3. **“Codex, convert this sync code into async httpx code.”**
4. **“Codex, add timeout, error handling, and JSON validation to my existing API call code.”**
5. **“Codex, refactor these API calls into reusable helper functions.”**

Codex can also auto-fix errors in API code and generate clean examples quickly.

---

## **10. Mini Exercises for Students**

### ✔️ Exercise 1

Write a Python script using **requests** to:

* Call `https://dummyjson.com/users`
* Show the first user’s **first name** and **age**

### ✔️ Exercise 2

Write a **POST request** to `https://httpbin.org/post` sending:

```json
{"message": "Hello world"}
```

Print the response JSON.

### ✔️ Exercise 3

Write an async **httpx** program to fetch:

* `/products/1`
* `/products/2`
* `/products/3`
  and print each product title.

---

