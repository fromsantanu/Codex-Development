# Chapter 4. Handling loading, error, and success states

## Introduction

Customers expect clear feedback, so we teach React to show loading spinners, friendly errors, and success confirmations when calling APIs. Our sample flow tracks a customer list request and gives the team confidence in what the UI is doing.

## Key Concepts

- **Loading state tells users the data is coming.** Like a “Please wait” sign while a backend report runs.
- **Error state shows when the API fails.** Similar to a clerk saying “I can’t reach the warehouse right now.”
- **Success state lets users know everything finished.** Show a short note once the data is on screen.

## Step-by-step Implementation

1. **Set up three state pieces.**

   ```jsx
   const [customers, setCustomers] = useState([]);
   const [status, setStatus] = useState('idle'); // idle, loading, success, error
   const [errorMessage, setErrorMessage] = useState('');
   ```

2. **Wrap the fetch in try/catch.**

   ```jsx
   useEffect(() => {
     async function loadCustomers() {
       setStatus('loading');
       try {
         const response = await fetch('/api/customers');
         if (!response.ok) {
           throw new Error('Server error');
         }
         const data = await response.json();
         setCustomers(data);
         setStatus('success');
       } catch (error) {
         setErrorMessage(error.message);
         setStatus('error');
       }
     }
     loadCustomers();
   }, []);
   ```

3. **Render statuses with friendly text.**

   ```jsx
   return (
     <div>
       <h1>Customer Insights</h1>
       {status === 'loading' && <p>Loading customers…</p>}
       {status === 'error' && <p className="error">Oops: {errorMessage}</p>}
       {status === 'success' && (
         <ul>
           {customers.map((customer) => (
             <li key={customer.id}>{customer.name}</li>
           ))}
         </ul>
       )}
     </div>
   );
   ```

4. **Success example.**

   ```
   -> status: 'success'
   -> customers: [ { "id": 1, "name": "Nina Patel" } ]
   -> UI shows the list and a short line “Loaded 1 customer.”
   ```

## How to Use Codex Here

1. “Modify the previous customer fetch code to track `status` and show when it is `loading`, `error`, or `success`.”
2. “Add error handling so `response.ok` is checked, and include an error message from the API if available.”
3. “Refactor the status rendering into a small `StatusMessage` component that accepts `status` and `errorMessage` props.”
4. “Suggest how to display a toast or banner when `status` becomes `success`.”

## Mini-Exercise

Keep the status tracking but also add a retry button that re-runs the fetch when the user clicks it after an error.
