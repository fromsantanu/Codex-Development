# Chapter 8. Using Codex for forms, API calls, refactors, and debugging

## Introduction

Codex is also a smart pair of eyes to improve existing code. We will show how to ask it to polish forms, tighten API calls, refactor helpers, and point out bugs in customer or clinic modules.

## Key Concepts

- **Codex refactors code to reduce duplication.** Ask it to extract components or hooks to keep logic DRY.
- **Codex spots bugs or missing error handling.** Give it the component and describe the problem; it can suggest a fix or a log.
- **Use Codex to enhance API calls.** For example, add a retries or central error formatter around `/api/customers`.

## Step-by-step Implementation

1. **Form refinement request.**

   Prompt Codex: “Improve this patient form by showing validation errors and disabling the submit button while the POST runs.” It can add `isSubmitting` flag and `errors` state.

   Result snippet:

   ```jsx
   const [isSubmitting, setIsSubmitting] = useState(false);
   const [errors, setErrors] = useState({});

   async function handleSubmit(event) {
     event.preventDefault();
     if (!form.name) {
       setErrors({ name: 'Name is required' });
       return;
     }
     setIsSubmitting(true);
     // fetch logic
     setIsSubmitting(false);
   }

   <button type="submit" disabled={isSubmitting}>
     {isSubmitting ? 'Saving…' : 'Register patient'}
   </button>
   ```

2. **API call helper.**

   Ask Codex: “Create a helper `apiClient` that takes a path and options, calls `fetch`, checks `response.ok`, and returns parsed JSON or throws an error.”

   That helper lets you replace repeated fetch blocks in customer and order modules with `apiClient('/api/customers')`.

3. **Refactoring a list component.**

   Give Codex the current list component and ask, “Extract the customer row markup into `CustomerRow` and show how to pass props.” Codex responds with two components and prop typing via comments.

4. **Debugging assistance.**

   Copy a failing component and say, “The loading spinner stays forever; help me find why.” Codex might point out that `setLoading(false)` is inside `try` but not `catch`, so it suggests moving it outside the `try/catch` block or using `finally`.

## How to Use Codex Here

1. “Add basic form validation to the patient registration form and display error messages near each input.”
2. “Create a shared `apiClient` function that wraps `fetch` and throws when `response.ok` is false.”
3. “Refactor the customer list into `CustomerList` and `CustomerRow`, then show how to pass a `customer` prop.”
4. “Debug why my component's `loading` state never becomes false and suggest the fix.”

## Mini-Exercise

Use Codex to help you add a confirmation modal before the form submits, and describe the prompt you used and the code it returned.
